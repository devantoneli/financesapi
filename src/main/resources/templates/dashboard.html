<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - GREC Finances</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">

</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="javascript:void(0)">
                <i class="fas fa-chart-line"></i> GREC Finances
            </a>
            <div class="navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/home}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" th:href="@{/dashboard}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/lancamentos}">LanÃ§amentos</a>
                    </li>
                </ul>
            </div>
            <div class="navbar-icons">
                <p class="h5" th:text="${nomeUsuario}"></p>
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user-circle"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/logout}">Sair</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    
    <main class="container-fluid">
        <div class="row g-2" style="padding:0 1rem">
            <div class="col-12 mb-1">
                <h1 class="title-lg">OlÃ¡, <span th:text="${resumo.nomeUsuario}">UsuÃ¡rio</span>! ðŸ‘‹</h1>
                <p class="subtitle">Esse Ã© o seu resumo financeiro desse mÃªs.</p>

                <div th:if="${resumo.saldo == 0 and resumo.receitaMensal == 0 and resumo.despesaMensal == 0}" class="alert alert-info text-center mt-3" role="alert">
                    <h4 class="alert-heading">Bem-vindo(a) ao seu Dashboard!</h4>
                    <p>Parece que vocÃª ainda nÃ£o tem dados financeiros registrados para este mÃªs.</p>
                    <hr>
                    <p class="mb-0">Que tal comeÃ§ar a adicionar seus primeiros <a th:href="@{/lancamentos}" class="alert-link">lanÃ§amentos</a> para ver seu resumo aqui?</p>
                </div>
            </div>
            
            <div class="col-12 col-lg-4">
                <div class="card custom">
                    <div class="summary-title">Saldo</div>
                    <div id="saldoValue" class="summary-value" th:classappend="${resumo.saldo == 0} ? 'empty' : ''" th:text="${resumo.saldo}">R$ 0,00</div>
                    <div class="summary-small">Atualmente</div>
                </div>
            </div>

            <div class="col-12 col-lg-4">
                <div class="card custom">
                    <div class="summary-title">Receita</div>
                    <div id="receitaValue" class="summary-value" th:classappend="${resumo.receitaMensal == 0} ? 'empty' : ''" th:text="${resumo.receitaMensal}">R$ 0,00</div>
                    <div class="summary-small">Esse mÃªs</div>
                </div>
            </div>

            <div class="col-12 col-lg-4">
                <div class="card custom">
                    <div class="summary-title">Despesa</div>
                    <div id="despesaValue" class="summary-value" th:classappend="${resumo.despesaMensal == 0} ? 'empty' : ''" th:text="${resumo.despesaMensal}">R$ 0,00</div>
                    <div class="summary-small">Esse mÃªs</div>
                </div>
            </div>
            
            <div class="col-12 col-lg-6">
                <div class="card custom">
                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <div>
                            <strong style="font-size:1rem">Receita (MÃªs Atual)</strong>
                        </div>
                        <button id="toggle-view-btn" class="btn btn-sm btn-icon">
                            <i class="fas fa-table"></i>
                        </button>
                    </div>

                    <!-- Container da VisÃ£o do GrÃ¡fico (PadrÃ£o) -->
                    <div id="monthly-chart-view">
                        <div th:if="${not resumo.receitaMesAtual.empty}" class="chart-wrap" id="monthly-chart-wrap">
                            <canvas id="receitaMesChart"></canvas>
                        </div>
                        <div th:unless="${not resumo.receitaMesAtual.empty}" class="no-data-message text-center p-4">
                            <i class="fas fa-chart-line fa-3x mb-3" style="color:var(--muted);"></i>
                            <p class="h5">Nenhuma receita registrada este mÃªs.</p>
                        </div>
                    </div>

                    <!-- Container da VisÃ£o da Tabela (Oculto) -->
                    <div id="monthly-table-view" class="hidden">
                        <div th:if="${not resumo.receitaMesAtual.empty}" class="transaction-list-wrap" id="monthly-table-wrap">
                            <!-- Tabela serÃ¡ gerada pelo JS -->
                        </div>
                        <div th:unless="${not resumo.receitaMesAtual.empty}" class="no-data-message text-center p-4">
                            <i class="fas fa-table fa-3x mb-3" style="color:var(--muted);"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card custom">
                    <div class="mb-3">
                        <strong style="font-size:1rem">Receita (Anual)</strong>
                    </div>
                    <div th:if="${not resumo.receitaUltimosMeses.empty}" class="chart-wrap">
                        <canvas id="receitaChart"></canvas>
                    </div>
                    <div th:unless="${not resumo.receitaUltimosMeses.empty}" class="no-data-message text-center p-4">
                        <i class="fas fa-chart-line fa-3x mb-3" style="color:var(--muted);"></i>
                        <p class="h5">Nenhuma receita anual registrada.</p>
                    </div>
                </div>
            </div>
            
            
            <div class="col-12 col-lg-6">
                <div class="card custom">
                    <div class="mb-3">
                        <strong style="font-size:1rem">Despesas por Categoria (MÃªs Atual)</strong>
                    </div>
                    <div th:if="${not resumo.categoriasDespesa.empty}" class="row align-items-center">
                        <div class="col-7">
                            <div class="chart-wrap-small" style="padding: 0; background: none;">
                                <canvas id="categoriaChart"></canvas>
                            </div>
                        </div>
                        <div class="col-5">
                            <div id="categoria-legend-list" class="category-legend-list">
                                <!-- A lista serÃ¡ gerada pelo JS aqui -->
                            </div>
                        </div>
                    </div>
                    <div th:unless="${not resumo.categoriasDespesa.empty}" class="no-data-message text-center p-4">
                        <i class="fas fa-tags fa-3x mb-3" style="color:var(--muted);"></i>
                        <p class="h5">Nenhuma despesa por categoria registrada este mÃªs.</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="card custom">
                    <div class="mb-3">
                        <strong style="font-size:1rem">Entradas e SaÃ­das</strong>
                    </div>
                    <div th:if="${not resumo.transacoesMes.empty}" class="transaction-list" id="entradas-saidas-list">
                        <!-- Itens serÃ£o gerados pelo JS -->
                    </div>
                    <div th:unless="${not resumo.transacoesMes.empty}" class="no-data-message text-center p-4">
                        <i class="fas fa-exchange-alt fa-3x mb-3" style="color:var(--muted);"></i>
                        <p class="h5">Nenhuma transaÃ§Ã£o registrada este mÃªs.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- small inline script to expose model to external JS -->
    <script th:inline="javascript">
    /*<![CDATA[*/
    window.__RESUMO = {
        nomeUsuario: /*[[${resumo.nomeUsuario}]]*/ 'UsuÃ¡rio',
        saldo: /*[[${resumo.saldo}]]*/ 0,
        receitaMensal: /*[[${resumo.receitaMensal}]]*/ 0,
        despesaMensal: /*[[${resumo.despesaMensal}]]*/ 0,
        receitaUltimosMeses: /*[[${resumo.receitaUltimosMeses}]]*/ [],
        receitaMesAtual: /*[[${resumo.receitaMesAtual}]]*/ [],
        despesasMensais: /*[[${resumo.despesasMensais}]]*/ [],
        transacoesMes: /*[[${resumo.transacoesMes}]]*/ [],
        categoriasDespesa: /*[[${resumo.categoriasDespesa}]]*/ []
    };
    /*]]>*/
    </script>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/js/dashboard.js"></script>

</body>
</html>
